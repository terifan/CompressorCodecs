package org.terifan.compression.basic_arithmetic;

import java.io.ByteArrayInputStream;
import java.io.ByteArrayOutputStream;
import java.io.IOException;
import java.util.Arrays;
import org.terifan.compression.io.BitInputStream;
import org.terifan.compression.io.BitOutputStream;
import testdata.LoadTestData.Source;
import static testdata.LoadTestData.loadTestData;


public class Test
{
	public static void main(String ... args)
	{
		try
		{
//			byte[] in = "The quick brown fox jumps over the lazy dog".getBytes();
//			byte[] in = "A number of optimizations can make these algorithms run more efficiently without changing the output. There is no need to represent the table in either the encoder or decoder. In the encoder, each row of the table can be represented by a single pointer into the strings, and the sort performed using the indices. Some care must be taken to ensure that the sort does not exhibit bad worst-case behavior: Standard library sort functions are unlikely to be appropriate. In the decoder, there is also no need to store the table, and in fact no sort is needed at all. In time proportional to the alphabet size and string length, the decoded string may be generated one character at a time from right to left. A \"character\" in the algorithm can be a byte, or a bit, or any other convenient size. There is no need to have an actual 'EOF' character. Instead, a pointer can be used that remembers where in a string the 'EOF' would be if it existed. In this approach, the output of the BWT must include both the transformed string, and the final value of the pointer. That means the BWT does expand its input slightly. The inverse transform then shrinks it back down to the original size: it is given a string and a pointer, and returns just a string. A complete description of the algorithms can be found in Burrows and Wheeler's paper[4][citation needed], or in a number of online sources. When a bijective variant of the Burrows-Wheeler transform is performed on \"^BANANA\", you get ANNBAA^ without the need for a special character for the end of the string. A special character forces one to increase character space by one, or to have a separate field with a numerical value for an offset. Either of these features makes data compression more difficult. When dealing with short files, the savings are great percentage-wise. The bijective transform is done by sorting all rotations of the Lyndon words. In comparing two strings of unequal length, one can compare the infinite periodic repetitions of each of these in lexicographic order and take the last column of the base-rotated Lyndon word. For example, the text \"^BANANA|\" is transformed into \"ANNBAA^|\" through these steps (the red | character indicates the EOF pointer) in the original string. The EOF character is unneeded in the bijective transform, so it is dropped during the transform and re-added to its proper place in the file.".getBytes();
//			byte[] in = "RIXY01276;COL;LVRIX000099775:00347510221856661841:00347510221856661858:00347510221856661940:00347510221856661957:00347510221856661964:00347510221856661971:00347510221856662039:00347510221856662046:00347510221856662053:00347510221856662060:00347510221856662084:00347510221856662091:00347510221856662152:00347510221856662169:00347510221856662176:00347510221856662183:00347510221856662497:00347510221856663029:00347510221856663036:00347510221856663043:00347510221856663050:00347510221856663722:00347510221856663739:00347510221856663746:00347510221856663753:00347510221856663784:00347510221856663791:00347510221856663807:00347510221856663814:00347510221856663876:00347510221856663883:00347510221856663890:00347510221856663906:00347510221856663913:00347510221856663920:00347510221856663937:00347510221856663944:00347510221856663951:00347510221856663968:00347510221856663975:00347510221856663982:00347510221856663999:00347510221856664002:00347510221856664019:00347510221856664026:00347510221856664040:00347510221856664057:00347510221856664064:00347510221856664071:00347510221856664866:00347510221856664873:00347510221856665573:00347510221856665580:00347510221856665955:00347510221856665962:00347510221856665979:00347510221856665986:00347510221856666648:00347510221856666860:00347510221856666877:00347510221856666884:00347510221856666891:00347510221856667225:00347510221856667232:00347510221856667331:00347510221856667348:00347510221856667355:00347510221856667362:00347510221856667423:00347510221856667430:00347510221856667447:00347510221856667454:00347510221856667492:00347510221856667508:00347510221856667515:00347510221856667522:00347510221856667690,LVRIX000099770:00347510221856661841:00347510221856661858:00347510221856661940:00347510221856661957:00347510221856661964:00347510221856661971:00347510221856662039:00347510221856662046:00347510221856662053:00347510221856662060:00347510221856662084:00347510221856662091:00347510221856662152:00347510221856662169:00347510221856662176:00347510221856662183:00347510221856662497:00347510221856663029:00347510221856663036:00347510221856663043:00347510221856663050:00347510221856663722:00347510221856663739:00347510221856663746:00347510221856663753:00347510221856663784:00347510221856663791:00347510221856663807:00347510221856663814:00347510221856663876:00347510221856663883:00347510221856663890:00347510221856663906:00347510221856663913:00347510221856663920:00347510221856663937:00347510221856663944:00347510221856663951:00347510221856663968:00347510221856663975:00347510221856663982:00347510221856663999:00347510221856664002:00347510221856664019:00347510221856664026:00347510221856664040:00347510221856664057:00347510221856664064:00347510221856664071:00347510221856664866:00347510221856664873:00347510221856665573:00347510221856665580:00347510221856665955:00347510221856665962:00347510221856665979:00347510221856665986:00347510221856666648:00347510221856666860:00347510221856666877:00347510221856666884:00347510221856666891:00347510221856667225:00347510221856667232:00347510221856667331:00347510221856667348:00347510221856667355:00347510221856667362:00347510221856667423:00347510221856667430:00347510221856667447:00347510221856667454:00347510221856667492:00347510221856667508:00347510221856667515:00347510221856667522:00347510221856667690,LVRIX000099746:00347510221856661841:00347510221856661858:00347510221856661940:00347510221856661957:00347510221856661964:00347510221856661971:00347510221856662039:00347510221856662046:00347510221856662053:00347510221856662060:00347510221856662084:00347510221856662091:00347510221856662152:00347510221856662169:00347510221856662176:00347510221856662183:00347510221856662497:00347510221856663029:00347510221856663036:00347510221856663043:00347510221856663050:00347510221856663722:00347510221856663739:00347510221856663746:00347510221856663753:00347510221856663784:00347510221856663791:00347510221856663807:00347510221856663814:00347510221856663876:00347510221856663883:00347510221856663890:00347510221856663906:00347510221856663913:00347510221856663920:00347510221856663937:00347510221856663944:00347510221856663951:00347510221856663968:00347510221856663975:00347510221856663982:00347510221856663999:00347510221856664002:00347510221856664019:00347510221856664026:00347510221856664040:00347510221856664057:00347510221856664064:00347510221856664071:00347510221856664866:00347510221856664873:00347510221856665573:00347510221856665580:00347510221856665955:00347510221856665962:00347510221856665979:00347510221856665986:00347510221856666648:00347510221856666860:00347510221856666877:00347510221856666884:00347510221856666891:00347510221856667225:00347510221856667232:00347510221856667331:00347510221856667348:00347510221856667355:00347510221856667362:00347510221856667423:00347510221856667430:00347510221856667447:00347510221856667454:00347510221856667492:00347510221856667508:00347510221856667515:00347510221856667522:00347510221856667690,LVRIX000099722:00347510221856661841:00347510221856661858:00347510221856661940:00347510221856661957:00347510221856661964:00347510221856661971:00347510221856662039:00347510221856662046:00347510221856662053:00347510221856662060:00347510221856662084:00347510221856662091:00347510221856662152:00347510221856662169:00347510221856662176:00347510221856662183:00347510221856662497:00347510221856663029:00347510221856663036:00347510221856663043:00347510221856663050:00347510221856663722:00347510221856663739:00347510221856663746:00347510221856663753:00347510221856663784:00347510221856663791:00347510221856663807:00347510221856663814:00347510221856663876:00347510221856663883:00347510221856663890:00347510221856663906:00347510221856663913:00347510221856663920:00347510221856663937:00347510221856663944:00347510221856663951:00347510221856663968:00347510221856663975:00347510221856663982:00347510221856663999:00347510221856664002:00347510221856664019:00347510221856664026:00347510221856664040:00347510221856664057:00347510221856664064:00347510221856664071:00347510221856664866:00347510221856664873:00347510221856665573:00347510221856665580:00347510221856665955:00347510221856665962:00347510221856665979:00347510221856665986:00347510221856666648:00347510221856666860:00347510221856666877:00347510221856666884:00347510221856666891:00347510221856667225:00347510221856667232:00347510221856667331:00347510221856667348:00347510221856667355:00347510221856667362:00347510221856667423:00347510221856667430:00347510221856667447:00347510221856667454:00347510221856667492:00347510221856667508:00347510221856667515:00347510221856667522:00347510221856667690,LVRIX000099720:00347510221856661841:00347510221856661858:00347510221856661940:00347510221856661957:00347510221856661964:00347510221856661971:00347510221856662039:00347510221856662046:00347510221856662053:00347510221856662060:00347510221856662084:00347510221856662091:00347510221856662152:00347510221856662169:00347510221856662176:00347510221856662183:00347510221856662497:00347510221856663029:00347510221856663036:00347510221856663043:00347510221856663050:00347510221856663722:00347510221856663739:00347510221856663746:00347510221856663753:00347510221856663784:00347510221856663791:00347510221856663807:00347510221856663814:00347510221856663876:00347510221856663883:00347510221856663890:00347510221856663906:00347510221856663913:00347510221856663920:00347510221856663937:00347510221856663944:00347510221856663951:00347510221856663968:00347510221856663975:00347510221856663982:00347510221856663999:00347510221856664002:00347510221856664019:00347510221856664026:00347510221856664040:00347510221856664057:00347510221856664064:00347510221856664071:00347510221856664866:00347510221856664873:00347510221856665573:00347510221856665580:00347510221856665955:00347510221856665962:00347510221856665979:00347510221856665986:00347510221856666648:00347510221856666860:00347510221856666877:00347510221856666884:00347510221856666891:00347510221856667225:00347510221856667232:00347510221856667331:00347510221856667348:00347510221856667355:00347510221856667362:00347510221856667423:00347510221856667430:00347510221856667447:00347510221856667454:00347510221856667492:00347510221856667508:00347510221856667515:00347510221856667522:00347510221856667690,LVRIX000099712:00347510221856661841:00347510221856661858:00347510221856661940:00347510221856661957:00347510221856661964:00347510221856661971:00347510221856662039:00347510221856662046:00347510221856662053:00347510221856662060:00347510221856662084:00347510221856662091:00347510221856662152:00347510221856662169:00347510221856662176:00347510221856662183:00347510221856662497:00347510221856663029:00347510221856663036:00347510221856663043:00347510221856663050:00347510221856663722:00347510221856663739:00347510221856663746:00347510221856663753:00347510221856663784:00347510221856663791:00347510221856663807:00347510221856663814:00347510221856663876:00347510221856663883:00347510221856663890:00347510221856663906:00347510221856663913:00347510221856663920:00347510221856663937:00347510221856663944:00347510221856663951:00347510221856663968:00347510221856663975:00347510221856663982:00347510221856663999:00347510221856664002:00347510221856664019:00347510221856664026:00347510221856664040:00347510221856664057:00347510221856664064:00347510221856664071:00347510221856664866:00347510221856664873:00347510221856665573:00347510221856665580:00347510221856665955:00347510221856665962:00347510221856665979:00347510221856665986:00347510221856666648:00347510221856666860:00347510221856666877:00347510221856666884:00347510221856666891:00347510221856667225:00347510221856667232:00347510221856667331:00347510221856667348:00347510221856667355:00347510221856667362:00347510221856667423:00347510221856667430:00347510221856667447:00347510221856667454:00347510221856667492:00347510221856667508:00347510221856667515:00347510221856667522:00347510221856667690,LVRIX000099706:00347510221856661841:00347510221856661858:00347510221856661940:00347510221856661957:00347510221856661964:00347510221856661971:00347510221856662039:00347510221856662046:00347510221856662053:00347510221856662060:00347510221856662084:00347510221856662091:00347510221856662152:00347510221856662169:00347510221856662176:00347510221856662183:00347510221856662497:00347510221856663029:00347510221856663036:00347510221856663043:00347510221856663050:00347510221856663722:00347510221856663739:00347510221856663746:00347510221856663753:00347510221856663784:00347510221856663791:00347510221856663807:00347510221856663814:00347510221856663876:00347510221856663883:00347510221856663890:00347510221856663906:00347510221856663913:00347510221856663920:00347510221856663937:00347510221856663944:00347510221856663951:00347510221856663968:00347510221856663975:00347510221856663982:00347510221856663999:00347510221856664002:00347510221856664019:00347510221856664026:00347510221856664040:00347510221856664057:00347510221856664064:00347510221856664071:00347510221856664866:00347510221856664873:00347510221856665573:00347510221856665580:00347510221856665955:00347510221856665962:00347510221856665979:00347510221856665986:00347510221856666648:00347510221856666860:00347510221856666877:00347510221856666884:00347510221856666891:00347510221856667225:00347510221856667232:00347510221856667331:00347510221856667348:00347510221856667355:00347510221856667362:00347510221856667423:00347510221856667430:00347510221856667447:00347510221856667454:00347510221856667492:00347510221856667508:00347510221856667515:00347510221856667522:00347510221856667690,LVRIX000099655:00347510221856661841:00347510221856661858:00347510221856661940:00347510221856661957:00347510221856661964:00347510221856661971:00347510221856662039:00347510221856662046:00347510221856662053:00347510221856662060:00347510221856662084:00347510221856662091:00347510221856662152:00347510221856662169:00347510221856662176:00347510221856662183:00347510221856662497:00347510221856663029:00347510221856663036:00347510221856663043:00347510221856663050:00347510221856663722:00347510221856663739:00347510221856663746:00347510221856663753:00347510221856663784:00347510221856663791:00347510221856663807:00347510221856663814:00347510221856663876:00347510221856663883:00347510221856663890:00347510221856663906:00347510221856663913:00347510221856663920:00347510221856663937:00347510221856663944:00347510221856663951:00347510221856663968:00347510221856663975:00347510221856663982:00347510221856663999:00347510221856664002:00347510221856664019:00347510221856664026:00347510221856664040:00347510221856664057:00347510221856664064:00347510221856664071:00347510221856664866:00347510221856664873:00347510221856665573:00347510221856665580:00347510221856665955:00347510221856665962:00347510221856665979:00347510221856665986:00347510221856666648:00347510221856666860:00347510221856666877:00347510221856666884:00347510221856666891:00347510221856667225:00347510221856667232:00347510221856667331:00347510221856667348:00347510221856667355:00347510221856667362:00347510221856667423:00347510221856667430:00347510221856667447:00347510221856667454:00347510221856667492:00347510221856667508:00347510221856667515:00347510221856667522:00347510221856667690,LVRIX000099643:00347510221856661841:00347510221856661858:00347510221856661940:00347510221856661957:00347510221856661964:00347510221856661971:00347510221856662039:00347510221856662046:00347510221856662053:00347510221856662060:00347510221856662084:00347510221856662091:00347510221856662152:00347510221856662169:00347510221856662176:00347510221856662183:00347510221856662497:00347510221856663029:00347510221856663036:00347510221856663043:00347510221856663050:00347510221856663722:00347510221856663739:00347510221856663746:00347510221856663753:00347510221856663784:00347510221856663791:00347510221856663807:00347510221856663814:00347510221856663876:00347510221856663883:00347510221856663890:00347510221856663906:00347510221856663913:00347510221856663920:00347510221856663937:00347510221856663944:00347510221856663951:00347510221856663968:00347510221856663975:00347510221856663982:00347510221856663999:00347510221856664002:00347510221856664019:00347510221856664026:00347510221856664040:00347510221856664057:00347510221856664064:00347510221856664071:00347510221856664866:00347510221856664873:00347510221856665573:00347510221856665580:00347510221856665955:00347510221856665962:00347510221856665979:00347510221856665986:00347510221856666648:00347510221856666860:00347510221856666877:00347510221856666884:00347510221856666891:00347510221856667225:00347510221856667232:00347510221856667331:00347510221856667348:00347510221856667355:00347510221856667362:00347510221856667423:00347510221856667430:00347510221856667447:00347510221856667454:00347510221856667492:00347510221856667508:00347510221856667515:00347510221856667522:00347510221856667690,LVRIX000099618:00347510221856661841:00347510221856661858:00347510221856661940:00347510221856661957:00347510221856661964:00347510221856661971:00347510221856662039:00347510221856662046:00347510221856662053:00347510221856662060:00347510221856662084:00347510221856662091:00347510221856662152:00347510221856662169:00347510221856662176:00347510221856662183:00347510221856662497:00347510221856663029:00347510221856663036:00347510221856663043:00347510221856663050:00347510221856663722:00347510221856663739:00347510221856663746:00347510221856663753:00347510221856663784:00347510221856663791:00347510221856663807:00347510221856663814:00347510221856663876:00347510221856663883:00347510221856663890:00347510221856663906:00347510221856663913:00347510221856663920:00347510221856663937:00347510221856663944:00347510221856663951:00347510221856663968:00347510221856663975:00347510221856663982:00347510221856663999:00347510221856664002:00347510221856664019:00347510221856664026:00347510221856664040:00347510221856664057:00347510221856664064:00347510221856664071:00347510221856664866:00347510221856664873:00347510221856665573:00347510221856665580:00347510221856665955:00347510221856665962:00347510221856665979:00347510221856665986:00347510221856666648:00347510221856666860:00347510221856666877:00347510221856666884:00347510221856666891:00347510221856667225:00347510221856667232:00347510221856667331:00347510221856667348:00347510221856667355:00347510221856667362:00347510221856667423:00347510221856667430:00347510221856667447:00347510221856667454:00347510221856667492:00347510221856667508:00347510221856667515:00347510221856667522:00347510221856667690,LVRIX000099609:00347510221856661841:00347510221856661858:00347510221856661940:00347510221856661957:00347510221856661964:00347510221856661971:00347510221856662039:00347510221856662046:00347510221856662053:00347510221856662060:00347510221856662084:00347510221856662091:00347510221856662152:00347510221856662169:00347510221856662176:00347510221856662183:00347510221856662497:00347510221856663029:00347510221856663036:00347510221856663043:00347510221856663050:00347510221856663722:00347510221856663739:00347510221856663746:00347510221856663753:00347510221856663784:00347510221856663791:00347510221856663807:00347510221856663814:00347510221856663876:00347510221856663883:00347510221856663890:00347510221856663906:00347510221856663913:00347510221856663920:00347510221856663937:00347510221856663944:00347510221856663951:00347510221856663968:00347510221856663975:00347510221856663982:00347510221856663999:00347510221856664002:00347510221856664019:00347510221856664026:00347510221856664040:00347510221856664057:00347510221856664064:00347510221856664071:00347510221856664866:00347510221856664873:00347510221856665573:00347510221856665580:00347510221856665955:00347510221856665962:00347510221856665979:00347510221856665986:00347510221856666648:00347510221856666860:00347510221856666877:00347510221856666884:00347510221856666891:00347510221856667225:00347510221856667232:00347510221856667331:00347510221856667348:00347510221856667355:00347510221856667362:00347510221856667423:00347510221856667430:00347510221856667447:00347510221856667454:00347510221856667492:00347510221856667508:00347510221856667515:00347510221856667522:00347510221856667690,LVRIX000099608:00347510221856661841:00347510221856661858:00347510221856661940:00347510221856661957:00347510221856661964:00347510221856661971:00347510221856662039:00347510221856662046:00347510221856662053:00347510221856662060:00347510221856662084:00347510221856662091:00347510221856662152:00347510221856662169:00347510221856662176:00347510221856662183:00347510221856662497:00347510221856663029:00347510221856663036:00347510221856663043:00347510221856663050:00347510221856663722:00347510221856663739:00347510221856663746:00347510221856663753:00347510221856663784:00347510221856663791:00347510221856663807:00347510221856663814:00347510221856663876:00347510221856663883:00347510221856663890:00347510221856663906:00347510221856663913:00347510221856663920:00347510221856663937:00347510221856663944:00347510221856663951:00347510221856663968:00347510221856663975:00347510221856663982:00347510221856663999:00347510221856664002:00347510221856664019:00347510221856664026:00347510221856664040:00347510221856664057:00347510221856664064:00347510221856664071:00347510221856664866:00347510221856664873:00347510221856665573:00347510221856665580:00347510221856665955:00347510221856665962:00347510221856665979:00347510221856665986:00347510221856666648:00347510221856666860:00347510221856666877:00347510221856666884:00347510221856666891:00347510221856667225:00347510221856667232:00347510221856667331:00347510221856667348:00347510221856667355:00347510221856667362:00347510221856667423:00347510221856667430:00347510221856667447:00347510221856667454:00347510221856667492:00347510221856667508:00347510221856667515:00347510221856667522:00347510221856667690,LVRIX000099606:00347510221856661841:00347510221856661858:00347510221856661940:00347510221856661957:00347510221856661964:00347510221856661971:00347510221856662039:00347510221856662046:00347510221856662053:00347510221856662060:00347510221856662084:00347510221856662091:00347510221856662152:00347510221856662169:00347510221856662176:00347510221856662183:00347510221856662497:00347510221856663029:00347510221856663036:00347510221856663043:00347510221856663050:00347510221856663722:00347510221856663739:00347510221856663746:00347510221856663753:00347510221856663784:00347510221856663791:00347510221856663807:00347510221856663814:00347510221856663876:00347510221856663883:00347510221856663890:00347510221856663906:00347510221856663913:00347510221856663920:00347510221856663937:00347510221856663944:00347510221856663951:00347510221856663968:00347510221856663975:00347510221856663982:00347510221856663999:00347510221856664002:00347510221856664019:00347510221856664026:00347510221856664040:00347510221856664057:00347510221856664064:00347510221856664071:00347510221856664866:00347510221856664873:00347510221856665573:00347510221856665580:00347510221856665955:00347510221856665962:00347510221856665979:00347510221856665986:00347510221856666648:00347510221856666860:00347510221856666877:00347510221856666884:00347510221856666891:00347510221856667225:00347510221856667232:00347510221856667331:00347510221856667348:00347510221856667355:00347510221856667362:00347510221856667423:00347510221856667430:00347510221856667447:00347510221856667454:00347510221856667492:00347510221856667508:00347510221856667515:00347510221856667522:00347510221856667690,LVRIX000099605:00347510221856661841:00347510221856661858:00347510221856661940:00347510221856661957:00347510221856661964:00347510221856661971:00347510221856662039:00347510221856662046:00347510221856662053:00347510221856662060:00347510221856662084:00347510221856662091:00347510221856662152:00347510221856662169:00347510221856662176:00347510221856662183:00347510221856662497:00347510221856663029:00347510221856663036:00347510221856663043:00347510221856663050:00347510221856663722:00347510221856663739:00347510221856663746:00347510221856663753:00347510221856663784:00347510221856663791:00347510221856663807:00347510221856663814:00347510221856663876:00347510221856663883:00347510221856663890:00347510221856663906:00347510221856663913:00347510221856663920:00347510221856663937:00347510221856663944:00347510221856663951:00347510221856663968:00347510221856663975:00347510221856663982:00347510221856663999:00347510221856664002:00347510221856664019:00347510221856664026:00347510221856664040:00347510221856664057:00347510221856664064:00347510221856664071:00347510221856664866:00347510221856664873:00347510221856665573:00347510221856665580:00347510221856665955:00347510221856665962:00347510221856665979:00347510221856665986:00347510221856666648:00347510221856666860:00347510221856666877:00347510221856666884:00347510221856666891:00347510221856667225:00347510221856667232:00347510221856667331:00347510221856667348:00347510221856667355:00347510221856667362:00347510221856667423:00347510221856667430:00347510221856667447:00347510221856667454:00347510221856667492:00347510221856667508:00347510221856667515:00347510221856667522:00347510221856667690,LVRIX000099604:00347510221856661841:00347510221856661858:00347510221856661940:00347510221856661957:00347510221856661964:00347510221856661971:00347510221856662039:00347510221856662046:00347510221856662053:00347510221856662060:00347510221856662084:00347510221856662091:00347510221856662152:00347510221856662169:00347510221856662176:00347510221856662183:00347510221856662497:00347510221856663029:00347510221856663036:00347510221856663043:00347510221856663050:00347510221856663722:00347510221856663739:00347510221856663746:00347510221856663753:00347510221856663784:00347510221856663791:00347510221856663807:00347510221856663814:00347510221856663876:00347510221856663883:00347510221856663890:00347510221856663906:00347510221856663913:00347510221856663920:00347510221856663937:00347510221856663944:00347510221856663951:00347510221856663968:00347510221856663975:00347510221856663982:00347510221856663999:00347510221856664002:00347510221856664019:00347510221856664026:00347510221856664040:00347510221856664057:00347510221856664064:00347510221856664071:00347510221856664866:00347510221856664873:00347510221856665573:00347510221856665580:00347510221856665955:00347510221856665962:00347510221856665979:00347510221856665986:00347510221856666648:00347510221856666860:00347510221856666877:00347510221856666884:00347510221856666891:00347510221856667225:00347510221856667232:00347510221856667331:00347510221856667348:00347510221856667355:00347510221856667362:00347510221856667423:00347510221856667430:00347510221856667447:00347510221856667454:00347510221856667492:00347510221856667508:00347510221856667515:00347510221856667522:00347510221856667690,LVRIX000099601:00347510221856661841:00347510221856661858:00347510221856661940:00347510221856661957:00347510221856661964:00347510221856661971:00347510221856662039:00347510221856662046:00347510221856662053:00347510221856662060:00347510221856662084:00347510221856662091:00347510221856662152:00347510221856662169:00347510221856662176:00347510221856662183:00347510221856662497:00347510221856663029:00347510221856663036:00347510221856663043:00347510221856663050:00347510221856663722:00347510221856663739:00347510221856663746:00347510221856663753:00347510221856663784:00347510221856663791:00347510221856663807:00347510221856663814:00347510221856663876:00347510221856663883:00347510221856663890:00347510221856663906:00347510221856663913:00347510221856663920:00347510221856663937:00347510221856663944:00347510221856663951:00347510221856663968:00347510221856663975:00347510221856663982:00347510221856663999:00347510221856664002:00347510221856664019:00347510221856664026:00347510221856664040:00347510221856664057:00347510221856664064:00347510221856664071:00347510221856664866:00347510221856664873:00347510221856665573:00347510221856665580:00347510221856665955:00347510221856665962:00347510221856665979:00347510221856665986:00347510221856666648:00347510221856666860:00347510221856666877:00347510221856666884:00347510221856666891:00347510221856667225:00347510221856667232:00347510221856667331:00347510221856667348:00347510221856667355:00347510221856667362:00347510221856667423:00347510221856667430:00347510221856667447:00347510221856667454:00347510221856667492:00347510221856667508:00347510221856667515:00347510221856667522:00347510221856667690,LVRIX000099581:00347510221856661841:00347510221856661858:00347510221856661940:00347510221856661957:00347510221856661964:00347510221856661971:00347510221856662039:00347510221856662046:00347510221856662053:00347510221856662060:00347510221856662084:00347510221856662091:00347510221856662152:00347510221856662169:00347510221856662176:00347510221856662183:00347510221856662497:00347510221856663029:00347510221856663036:00347510221856663043:00347510221856663050:00347510221856663722:00347510221856663739:00347510221856663746:00347510221856663753:00347510221856663784:00347510221856663791:00347510221856663807:00347510221856663814:00347510221856663876:00347510221856663883:00347510221856663890:00347510221856663906:00347510221856663913:00347510221856663920:00347510221856663937:00347510221856663944:00347510221856663951:00347510221856663968:00347510221856663975:00347510221856663982:00347510221856663999:00347510221856664002:00347510221856664019:00347510221856664026:00347510221856664040:00347510221856664057:00347510221856664064:00347510221856664071:00347510221856664866:00347510221856664873:00347510221856665573:00347510221856665580:00347510221856665955:00347510221856665962:00347510221856665979:00347510221856665986:00347510221856666648:00347510221856666860:00347510221856666877:00347510221856666884:00347510221856666891:00347510221856667225:00347510221856667232:00347510221856667331:00347510221856667348:00347510221856667355:00347510221856667362:00347510221856667423:00347510221856667430:00347510221856667447:00347510221856667454:00347510221856667492:00347510221856667508:00347510221856667515:00347510221856667522:00347510221856667690,LVRIX000099578:00347510221856661841:00347510221856661858:00347510221856661940:00347510221856661957:00347510221856661964:00347510221856661971:00347510221856662039:00347510221856662046:00347510221856662053:00347510221856662060:00347510221856662084:00347510221856662091:00347510221856662152:00347510221856662169:00347510221856662176:00347510221856662183:00347510221856662497:00347510221856663029:00347510221856663036:00347510221856663043:00347510221856663050:00347510221856663722:00347510221856663739:00347510221856663746:00347510221856663753:00347510221856663784:00347510221856663791:00347510221856663807:00347510221856663814:00347510221856663876:00347510221856663883:00347510221856663890:00347510221856663906:00347510221856663913:00347510221856663920:00347510221856663937:00347510221856663944:00347510221856663951:00347510221856663968:00347510221856663975:00347510221856663982:00347510221856663999:00347510221856664002:00347510221856664019:00347510221856664026:00347510221856664040:00347510221856664057:00347510221856664064:00347510221856664071:00347510221856664866:00347510221856664873:00347510221856665573:00347510221856665580:00347510221856665955:00347510221856665962:00347510221856665979:00347510221856665986:00347510221856666648:00347510221856666860:00347510221856666877:00347510221856666884:00347510221856666891:00347510221856667225:00347510221856667232:00347510221856667331:00347510221856667348:00347510221856667355:00347510221856667362:00347510221856667423:00347510221856667430:00347510221856667447:00347510221856667454:00347510221856667492:00347510221856667508:00347510221856667515:00347510221856667522:00347510221856667690,LVRIX000099572:00347510221856661841:00347510221856661858:00347510221856661940:00347510221856661957:00347510221856661964:00347510221856661971:00347510221856662039:00347510221856662046:00347510221856662053:00347510221856662060:00347510221856662084:00347510221856662091:00347510221856662152:00347510221856662169:00347510221856662176:00347510221856662183:00347510221856662497:00347510221856663029:00347510221856663036:00347510221856663043:00347510221856663050:00347510221856663722:00347510221856663739:00347510221856663746:00347510221856663753:00347510221856663784:00347510221856663791:00347510221856663807:00347510221856663814:00347510221856663876:00347510221856663883:00347510221856663890:00347510221856663906:00347510221856663913:00347510221856663920:00347510221856663937:00347510221856663944:00347510221856663951:00347510221856663968:00347510221856663975:00347510221856663982:00347510221856663999:00347510221856664002:00347510221856664019:00347510221856664026:00347510221856664040:00347510221856664057:00347510221856664064:00347510221856664071:00347510221856664866:00347510221856664873:00347510221856665573:00347510221856665580:00347510221856665955:00347510221856665962:00347510221856665979:00347510221856665986:00347510221856666648:00347510221856666860:00347510221856666877:00347510221856666884:00347510221856666891:00347510221856667225:00347510221856667232:00347510221856667331:00347510221856667348:00347510221856667355:00347510221856667362:00347510221856667423:00347510221856667430:00347510221856667447:00347510221856667454:00347510221856667492:00347510221856667508:00347510221856667515:00347510221856667522:00347510221856667690,LVRIX000099570:00347510221856661841:00347510221856661858:00347510221856661940:00347510221856661957:00347510221856661964:00347510221856661971:00347510221856662039:00347510221856662046:00347510221856662053:00347510221856662060:00347510221856662084:00347510221856662091:00347510221856662152:00347510221856662169:00347510221856662176:00347510221856662183:00347510221856662497:00347510221856663029:00347510221856663036:00347510221856663043:00347510221856663050:00347510221856663722:00347510221856663739:00347510221856663746:00347510221856663753:00347510221856663784:00347510221856663791:00347510221856663807:00347510221856663814:00347510221856663876:00347510221856663883:00347510221856663890:00347510221856663906:00347510221856663913:00347510221856663920:00347510221856663937:00347510221856663944:00347510221856663951:00347510221856663968:00347510221856663975:00347510221856663982:00347510221856663999:00347510221856664002:00347510221856664019:00347510221856664026:00347510221856664040:00347510221856664057:00347510221856664064:00347510221856664071:00347510221856664866:00347510221856664873:00347510221856665573:00347510221856665580:00347510221856665955:00347510221856665962:00347510221856665979:00347510221856665986:00347510221856666648:00347510221856666860:00347510221856666877:00347510221856666884:00347510221856666891:00347510221856667225:00347510221856667232:00347510221856667331:00347510221856667348:00347510221856667355:00347510221856667362:00347510221856667423:00347510221856667430:00347510221856667447:00347510221856667454:00347510221856667492:00347510221856667508:00347510221856667515:00347510221856667522:00347510221856667690,LVRIX000099568:00347510221856661841:00347510221856661858:00347510221856661940:00347510221856661957:00347510221856661964:00347510221856661971:00347510221856662039:00347510221856662046:00347510221856662053:00347510221856662060:00347510221856662084:00347510221856662091:00347510221856662152:00347510221856662169:00347510221856662176:00347510221856662183:00347510221856662497:00347510221856663029:00347510221856663036:00347510221856663043:00347510221856663050:00347510221856663722:00347510221856663739:00347510221856663746:00347510221856663753:00347510221856663784:00347510221856663791:00347510221856663807:00347510221856663814:00347510221856663876:00347510221856663883:00347510221856663890:00347510221856663906:00347510221856663913:00347510221856663920:00347510221856663937:00347510221856663944:00347510221856663951:00347510221856663968:00347510221856663975:00347510221856663982:00347510221856663999:00347510221856664002:00347510221856664019:00347510221856664026:00347510221856664040:00347510221856664057:00347510221856664064:00347510221856664071:00347510221856664866:00347510221856664873:00347510221856665573:00347510221856665580:00347510221856665955:00347510221856665962:00347510221856665979:00347510221856665986:00347510221856666648:00347510221856666860:00347510221856666877:00347510221856666884:00347510221856666891:00347510221856667225:00347510221856667232:00347510221856667331:00347510221856667348:00347510221856667355:00347510221856667362:00347510221856667423:00347510221856667430:00347510221856667447:00347510221856667454:00347510221856667492:00347510221856667508:00347510221856667515:00347510221856667522:00347510221856667690,LVRIX000099567:00347510221856661841:00347510221856661858:00347510221856661940:00347510221856661957:00347510221856661964:00347510221856661971:00347510221856662039:00347510221856662046:00347510221856662053:00347510221856662060:00347510221856662084:00347510221856662091:00347510221856662152:00347510221856662169:00347510221856662176:00347510221856662183:00347510221856662497:00347510221856663029:00347510221856663036:00347510221856663043:00347510221856663050:00347510221856663722:00347510221856663739:00347510221856663746:00347510221856663753:00347510221856663784:00347510221856663791:00347510221856663807:00347510221856663814:00347510221856663876:00347510221856663883:00347510221856663890:00347510221856663906:00347510221856663913:00347510221856663920:00347510221856663937:00347510221856663944:00347510221856663951:00347510221856663968:00347510221856663975:00347510221856663982:00347510221856663999:00347510221856664002:00347510221856664019:00347510221856664026:00347510221856664040:00347510221856664057:00347510221856664064:00347510221856664071:00347510221856664866:00347510221856664873:00347510221856665573:00347510221856665580:00347510221856665955:00347510221856665962:00347510221856665979:00347510221856665986:00347510221856666648:00347510221856666860:00347510221856666877:00347510221856666884:00347510221856666891:00347510221856667225:00347510221856667232:00347510221856667331:00347510221856667348:00347510221856667355:00347510221856667362:00347510221856667423:00347510221856667430:00347510221856667447:00347510221856667454:00347510221856667492:00347510221856667508:00347510221856667515:00347510221856667522:00347510221856667690,LVRIX000099564:00347510221856661841:00347510221856661858:00347510221856661940:00347510221856661957:00347510221856661964:00347510221856661971:00347510221856662039:00347510221856662046:00347510221856662053:00347510221856662060:00347510221856662084:00347510221856662091:00347510221856662152:00347510221856662169:00347510221856662176:00347510221856662183:00347510221856662497:00347510221856663029:00347510221856663036:00347510221856663043:00347510221856663050:00347510221856663722:00347510221856663739:00347510221856663746:00347510221856663753:00347510221856663784:00347510221856663791:00347510221856663807:00347510221856663814:00347510221856663876:00347510221856663883:00347510221856663890:00347510221856663906:00347510221856663913:00347510221856663920:00347510221856663937:00347510221856663944:00347510221856663951:00347510221856663968:00347510221856663975:00347510221856663982:00347510221856663999:00347510221856664002:00347510221856664019:00347510221856664026:00347510221856664040:00347510221856664057:00347510221856664064:00347510221856664071:00347510221856664866:00347510221856664873:00347510221856665573:00347510221856665580:00347510221856665955:00347510221856665962:00347510221856665979:00347510221856665986:00347510221856666648:00347510221856666860:00347510221856666877:00347510221856666884:00347510221856666891:00347510221856667225:00347510221856667232:00347510221856667331:00347510221856667348:00347510221856667355:00347510221856667362:00347510221856667423:00347510221856667430:00347510221856667447:00347510221856667454:00347510221856667492:00347510221856667508:00347510221856667515:00347510221856667522:00347510221856667690,LVRIX000099562:00347510221856661841:00347510221856661858:00347510221856661940:00347510221856661957:00347510221856661964:00347510221856661971:00347510221856662039:00347510221856662046:00347510221856662053:00347510221856662060:00347510221856662084:00347510221856662091:00347510221856662152:00347510221856662169:00347510221856662176:00347510221856662183:00347510221856662497:00347510221856663029:00347510221856663036:00347510221856663043:00347510221856663050:00347510221856663722:00347510221856663739:00347510221856663746:00347510221856663753:00347510221856663784:00347510221856663791:00347510221856663807:00347510221856663814:00347510221856663876:00347510221856663883:00347510221856663890:00347510221856663906:00347510221856663913:00347510221856663920:00347510221856663937:00347510221856663944:00347510221856663951:00347510221856663968:00347510221856663975:00347510221856663982:00347510221856663999:00347510221856664002:00347510221856664019:00347510221856664026:00347510221856664040:00347510221856664057:00347510221856664064:00347510221856664071:00347510221856664866:00347510221856664873:00347510221856665573:00347510221856665580:00347510221856665955:00347510221856665962:00347510221856665979:00347510221856665986:00347510221856666648:00347510221856666860:00347510221856666877:00347510221856666884:00347510221856666891:00347510221856667225:00347510221856667232:00347510221856667331:00347510221856667348:00347510221856667355:00347510221856667362:00347510221856667423:00347510221856667430:00347510221856667447:00347510221856667454:00347510221856667492:00347510221856667508:00347510221856667515:00347510221856667522:00347510221856667690,RIX9239444:00347510221856662374:00347510221856662381:00347510221856662398:00347510221856662404,RIX9239550:00347510221856666082:00347510221856666099:00347510221856666105:00347510221856666112".getBytes();

			byte[] in = loadTestData(Source.LENNA_GRAY);

			byte[] bwt = in.clone();
//			int index = BWT.encode(bwt);

			test(in, false, false, "");
			test(in, false, true, "    predict");
			test(bwt, false, false, "bwt");
			test(bwt, false, true, "bwt predict");

			test(in, true, false, "            mtf");
			test(in, true, true, "    predict mtf");
			test(bwt, true, false, "bwt         mtf");
			test(bwt, true, true, "bwt predict mtf");
		}
		catch (Throwable e)
		{
			e.printStackTrace(System.out);
		}
	}


	private static void test(byte[] aPlainText, boolean aMTF, boolean aPredict, String aDescription) throws IOException
	{
		byte [] compressedData;
		byte [] decompressedData;

		{
			int[] order = new int[256];
			for (int i = 0; i < 256; i++)
			{
				order[i] = i;
			}

			ByteArrayOutputStream baos = new ByteArrayOutputStream();

			try (BitOutputStream bos = new BitOutputStream(baos))
			{
				BasicArithmeticContext[] context = new BasicArithmeticContext[aPredict ? 256 : 1];
				for (int i = 0; i < context.length; i++)
				{
					context[i] = new BasicArithmeticContext(256, true);
				}

				BasicArithmeticEncoder encoder = new BasicArithmeticEncoder(bos);
				for (int i = 0, p = 0; i < aPlainText.length; i++)
				{
					int c = aPlainText[i] & 255;
					int sym = c;

					if (aMTF)
					{
						for (int k = 0; k < 256; k++)
						{
							if (order[k] == c)
							{
								sym = k;
								break;
							}
						}
					}

					encoder.encode(sym, context[p]);

					if (aMTF)
					{
						for (int j = sym; j > 0; j--)
						{
							order[j] = order[j - 1];
						}
						order[0] = c;
					}

					if (aPredict)
					{
						p = sym;
					}
				}
				encoder.close();
			}

			compressedData = baos.toByteArray();
		}

		{
			int[] order = new int[256];
			for (int i = 0; i < 256; i++)
			{
				order[i] = i;
			}

			BasicArithmeticContext[] context = new BasicArithmeticContext[aPredict ? 256 : 1];
			for (int i = 0; i < context.length; i++)
			{
				context[i] = new BasicArithmeticContext(256, true);
			}

			BasicArithmeticDecoder decoder = new BasicArithmeticDecoder(new BitInputStream(new ByteArrayInputStream(compressedData)));

			ByteArrayOutputStream baos = new ByteArrayOutputStream();

			for (int i = 0, p = 0; i < aPlainText.length; i++)
			{
				int c = decoder.decode(context[p]);
				int sym = c;

				if (aMTF)
				{
					sym = order[c];
				}

				baos.write(sym);

				if (aMTF)
				{
					for (int j = c; j > 0; j--)
					{
						order[j] = order[j - 1];
					}
					order[0] = sym;
				}
				if (aPredict)
				{
					p = c;
				}
			}

			decompressedData = baos.toByteArray();
		}

		System.out.printf("[%-15s] success=%b, in=%d, out=%d, ratio=%.1f\n", aDescription, Arrays.equals(aPlainText, decompressedData), aPlainText.length, compressedData.length, 100 - compressedData.length*100.0 / aPlainText.length);
	}
}